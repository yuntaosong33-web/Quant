# A股量化交易系统 - 策略配置文件
# ===============================
# 中证1000 强动量 + 情绪进攻策略 (Aggressive Momentum & Sentiment Strategy)

# 数据配置
data:
  # 股票池: hs300(沪深300), zz500(中证500), zz1000(中证1000), all(全市场)
  # [SWITCH] 切换到中证1000以配合激进动量策略
  stock_pool: "zz1000"
  
  # 历史数据开始日期
  start_date: "2020-01-01"
  
  # 每次增量更新的天数（建议至少30天，以支持ROC_20等因子计算）
  update_days: 30
  
  # 数据存储路径
  raw_data_path: "data/raw"
  processed_data_path: "data/processed"

# 策略配置 - 中证1000多因子策略
strategy:
  # 策略名称
  name: "Balanced Multi-Factor"
  
  # 因子权重配置 (平衡型 - 动量+小市值+低波)
  # 注：价值因子因数据源限制(PE数据缺失)暂时禁用
  value_weight: 0.0      # 价值因子 - 禁用（数据源不支持）
  quality_weight: 0.2    # 低波因子 (IVOL) - 20%
  momentum_weight: 0.45  # 动量因子 - 45%（+5%）
  size_weight: 0.35      # 小市值因子 - 35%（+5%）
  sentiment_weight: 0.0  # 禁用情绪因子
  
  # 选股参数
  top_n: 4              # 持仓4只，聚焦高质量
  min_listing_days: 126 # 约6个月上市时间
  
  # 风控熔断阈值
  turnover_threshold: 10.0   # 禁用换手率熔断
  volatility_threshold: 2.0  # 适中的波动率限制
  
  # 板块过滤
  exclude_chinext: false  # 启用创业板
  exclude_star: false     # 启用科创板
  
  # 因子列名配置
  value_col: "value_zscore"
  quality_col: "ivol_zscore"
  momentum_col: "sharpe_60_zscore"   # 60日夏普动量（更稳定）
  size_col: "small_cap_zscore"
  
  # 调仓频率
  rebalance_frequency: "weekly"
  
  # 再平衡缓冲区
  rebalance_buffer: 0.30    # 30% 缓冲减少交易
  
  # 持股惯性加分
  holding_bonus: 0.5        # 0.5 标准差（经验证的最优值）

# 投资组合配置 - 激进型（集中持仓）
portfolio:
  # 总资金（元）
  total_capital: 300000
  
  # 单只股票最大权重
  # 对于10只股票的激进策略，单只上限25%
  max_weight: 0.25
  
  # 单只股票最小权重
  min_weight: 0.0
  
  # 无风险利率
  risk_free_rate: 0.02
  
  # 优化目标: max_sharpe(最大夏普比率), min_volatility(最小波动率), equal_weight(等权重)
  # 激进策略使用等权重，避免优化器在高波动股票上的不稳定
  optimization_objective: "equal_weight"
  
  # 协方差压缩方法: ledoit_wolf, oracle_approximating, exponential
  shrinkage_type: "ledoit_wolf"
  
  # 预期收益率计算方法: mean_historical, ema_historical
  returns_method: "mean_historical"
  
  # 协方差计算回溯天数
  lookback_days: 252

  # 风险控制配置 - 激进型参数（30万资金实盘优化）
risk:
  # 止损比例（放宽：避免频繁被洗）
  stop_loss: 0.08
  
  # 止盈比例
  take_profit: 0.30
  
  # 单日最大亏损比例
  max_daily_loss: 0.05
  
  # 最大回撤限制（放宽：容忍更高波动以获取高收益）
  max_drawdown: 0.25
  
  # ===== ATR 动态止损配置 =====
  # ATR 止损根据市场波动率自动调整止损位，比固定比例止损更智能
  use_atr_stop_loss: true       # 启用 ATR 止损
  atr_period: 14                # ATR 计算周期（14日）
  atr_multiplier: 1.5           # ATR 止损倍数（激进策略收紧至1.5，跑得快）
  atr_trailing: true            # 是否启用移动止损（跟踪盈利）
  
  # 大盘风控参数
  # 仅当大盘跌破60日均线且20日跌幅超过8%时才触发熔断
  market_risk:
    enabled: true         # 启用风控
    ma_period: 60
    drop_threshold: 0.08  # 8% 跌幅阈值
    drop_lookback: 20

# LLM 情绪分析配置（优化版）
# 情绪进攻型策略：情绪分数作为 Alpha 因子加成，而非仅用于过滤
# 采用两阶段选股模式：
#   1. 技术面初筛 → Top N * buffer 候选股
#   2. LLM 情绪分析 → 获取情绪分数
#   3. Final_Score = Base_Score + Sentiment_Weight * Sentiment_Score → 最终排名
llm:
  # 提供商: qwen (阿里云通义千问)
  provider: "qwen"
  
  # 主模型名称 (qwen-max 是通义千问旗舰版)
  model: "qwen-max"
  
  # 备用模型（主模型失败时自动降级）
  # 推荐使用更便宜的模型作为 fallback，如 qwen-turbo 或 deepseek-chat
  fallback_model: "qwen-turbo"
  
  # API 端点 (阿里云 DashScope OpenAI 兼容模式)
  base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
  
  # API Key (阿里云 DashScope)
  # 建议通过环境变量 QWEN_API_KEY 配置，更安全
  api_key: "sk-a4eee1b50b9341c4a3f4f9abefe7460d"
  
  # 是否启用情绪分析
  enable_sentiment_filter: true
  
  # 情绪分数阈值（用于极端负面情况的安全过滤）
  # 分数范围: -1.0 (极度负面) 到 1.0 (极度正面)
  # 低于此阈值的股票仍会被禁止交易（黑天鹅风控）
  sentiment_threshold: -0.5
  
  # ===== 缓存配置 =====
  
  # 情绪缓存文件路径
  cache_path: "data/processed/sentiment_cache.json"
  
  # 缓存过期天数（超过此时间的缓存会被重新获取）
  cache_ttl_days: 7
  
  # ===== API 配置 =====
  
  # API 请求超时时间（秒）
  request_timeout: 30
  
  # API 最大重试次数
  max_retries: 3
  
  # 最大并发请求数（批量分析时的并发限制）
  # 过高可能触发 API 限流，建议 3-10
  max_concurrent: 5
  
  # ===== 提示词配置 =====
  
  # 是否使用详细提示词（更多 Token 但分析更准确）
  # true: 使用 CoT 思维链引导，输出更详细
  # false: 使用简化提示词，节省 Token 成本
  detailed_prompts: true
  
  # ===== 熔断器与置信度配置 =====
  
  # 熔断器阈值：连续 API 调用失败次数
  # 超过此阈值时，系统将抛出 LLMCircuitBreakerError 异常停止交易
  max_consecutive_failures: 5
  
  # 最低置信度阈值
  # LLM 返回的置信度低于此值的分析结果将被忽略
  min_confidence: 0.7
  
  # 情绪分析缓冲区乘数
  # 选取 top_n * buffer_multiplier 只股票进行情绪分析
  sentiment_buffer_multiplier: 5

# 交易配置
trading:
  # 交易费用（双边）- 标准A股费率
  commission_rate: 0.0003
  
  # 印花税（卖出时）
  stamp_duty: 0.001
  
  # 滑点比例
  slippage: 0.001
  
  # 最小交易单位（股）
  min_trade_unit: 100

# 报告配置
report:
  # 报告格式: markdown, html
  format: "html"
  
  # 报告输出目录
  output_dir: "reports"
  
  # 是否发送邮件通知
  send_email: false
  
  # 邮件配置
  email:
    smtp_server: ""
    smtp_port: 587
    sender: ""
    password: ""
    recipients: []

# 消息推送配置
notification:
  # PushPlus 微信推送 (http://www.pushplus.plus/)
  # Token 获取方式：注册 PushPlus 账号后，在个人中心获取
  # 也可通过环境变量 PUSHPLUS_TOKEN 配置（优先级更高）
  pushplus_token: "c71a6a03122e41e3b0b691693748c0ce"
  
  # 是否启用推送
  enabled: true

# 日志配置
logging:
  # 日志级别: DEBUG, INFO, WARNING, ERROR
  level: "INFO"
  
  # 日志文件目录
  log_dir: "logs"
  
  # 日志文件保留天数
  retention_days: 30

# 回测配置
backtest:
  # 回测开始日期
  start_date: "2024-01-01"
  
  # 回测结束日期
  end_date: "2025-01-01"
  
  # 初始资金
  initial_capital: 300000
  
  # 基准指数
  # [SWITCH] 配合股票池切换，基准改为沪深300 (000300)
  benchmark: "000300"  # 沪深300

  # 回测最大股票数量（避免数据下载耗时过长，全市场回测请设为 5000）
  max_stocks: 2000
