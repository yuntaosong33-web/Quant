# A股量化交易系统 - 策略配置文件
# ===============================
# HS300 深度价值与龙头动量策略 (Deep Value & Quality Strategy)

# 数据配置
data:
  # 数据源：tushare (推荐，稳定可靠) 或 akshare (免费但不稳定)
  data_source: "tushare"
  
  # 股票池: hs300(沪深300), zz500(中证500), zz1000(中证1000), all(全市场)
  # [核心修改] 切换到沪深300，聚焦大盘蓝筹龙头
  stock_pool: "hs300"
  
  # 历史数据开始日期
  start_date: "2020-01-01"
  
  # 每次增量更新的天数（建议至少30天，以支持ROC_20等因子计算）
  update_days: 30
  
  # 数据存储路径
  raw_data_path: "data/raw"
  processed_data_path: "data/processed"

# Tushare 配置
# 获取 Token: https://tushare.pro/register
# 也可通过环境变量 TUSHARE_TOKEN 设置
tushare:
  # API Token
  api_token: "7de46c74cf5f993d70c5ff931bd1a0c420a950ca4d35671010d244ba"
  
  # 缓存目录
  cache_dir: "data/tushare_cache"
  
  # 请求限流（每分钟最大请求数，免费用户约 200，付费用户约 500）
  rate_limit: 200

# ============================================================
# 策略配置 - HS300 均衡增长策略
# ============================================================
# 策略逻辑：
#   1. 动量为王：优先选择趋势向上的股票
#   2. 质量辅助：ROE 筛选高盈利公司
#   3. 价值兜底：避免买入极度高估的股票
#   4. 月度调仓，集中持仓（6只）
# ============================================================
strategy:
  # 策略名称
  name: "HS300 Balanced Growth"
  
  # ===== 因子权重配置 (均衡增长型) =====
  # 核心逻辑：动量主导 + 质量过滤 + 价值兜底
  # 避免过度集中于低估值的银行保险股
  value_weight: 0.10      # 价值因子 - 10% (降低：避免银行保险主导)
  quality_weight: 0.15    # 质量因子 - 20% (高ROE盈利能力)
  momentum_weight: 0.75   # 动量因子 - 70% (核心：趋势向上的股票)
  size_weight: 0.0        # 小市值因子 - 0% (移除，专注大盘股)
  sentiment_weight: 0.0   # 情绪因子 - 0% (暂时关闭)
  
  # ===== 选股参数 =====
  top_n: 6                # 极度集中持仓，仅选前4名
  min_listing_days: 252   # 至少上市1年（约252个交易日）
  
  # ===== 风控熔断阈值 =====
  turnover_threshold: 20.0   # 放宽换手率限制（大盘股换手率较低）
  volatility_threshold: 3.0  # 放宽波动率限制（给予更多容忍度）
  
  # ===== 板块过滤 =====
  exclude_chinext: false  # 不排除创业板（部分HS300成分股在创业板）
  exclude_star: false     # 不排除科创板（部分HS300成分股在科创板）
  
  # ===== 因子列名映射 =====
  # 注意：需要在因子计算模块中实现对应的因子
  value_col: "value_composite_zscore"   # 复合估值因子 (EP + BP + DP)
  quality_col: "roe_zscore"             # ROE 盈利能力因子
  momentum_col: "sharpe_60_zscore"      # 60日夏普动量（中期稳健）
  size_col: "small_cap_zscore"          # 保留配置但权重为0
  
  # ===== 调仓配置 =====
  rebalance_frequency: "weekly"  # 周度调仓
  rebalance_buffer: 0.05          # 5% 缓冲区（允许小幅偏离）
  
  # ===== 持股惯性 =====
  holding_bonus: 0.3              # 持股惯性加分（降低换手）

# ============================================================
# 风险控制配置 - 保守型参数
# ============================================================
risk:
  # ===== 基础止损止盈 =====
  stop_loss: 0.10         # 10% 止损（保守策略）
  take_profit: 0.30       # 30% 止盈
  
  # ===== 组合风险限制 =====
  max_daily_loss: 0.05    # 单日最大亏损 5%
  max_drawdown: 0.20      # 最大回撤限制 20%（保守）
  
  # ===== ATR 动态止损配置 =====
  use_atr_stop_loss: true       # 启用 ATR 止损
  atr_period: 14                # ATR 计算周期（14日）
  atr_multiplier: 2.5           # ATR 止损倍数（保守策略放宽至2.5）
  atr_trailing: true            # 启用移动止损（跟踪盈利）
  
  # ===== 大盘风控参数 =====
  # 规则：跌破60日均线 且 20日跌幅超过5% 时触发清仓
  market_risk:
    enabled: true         # 启用大盘风控
    ma_period: 60         # 60日均线
    drop_threshold: 0.05  # 5% 跌幅阈值
    drop_lookback: 20     # 回溯20日计算跌幅

# 投资组合配置 - 集中持仓型
portfolio:
  # 总资金（元）
  total_capital: 300000
  
  # 单只股票最大权重（6只股票，最大约17%）
  max_weight: 0.20
  
  # 单只股票最小权重
  min_weight: 0.0
  
  # 无风险利率
  risk_free_rate: 0.02
  
  # 优化目标: max_sharpe(最大夏普比率), min_volatility(最小波动率), equal_weight(等权重)
  # 价值策略使用等权重分配
  optimization_objective: "equal_weight"
  
  # 协方差压缩方法: ledoit_wolf, oracle_approximating, exponential
  shrinkage_type: "ledoit_wolf"
  
  # 预期收益率计算方法: mean_historical, ema_historical
  returns_method: "mean_historical"
  
  # 协方差计算回溯天数
  lookback_days: 252

# LLM 情绪分析配置
llm:
  # 提供商: qwen (阿里云通义千问)
  provider: "qwen"
  
  # 主模型名称 (qwen-max 是通义千问旗舰版)
  model: "qwen-max"
  
  # 备用模型（主模型失败时自动降级）
  fallback_model: "qwen-turbo"
  
  # API 端点 (阿里云 DashScope OpenAI 兼容模式)
  base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
  
  # API Key (阿里云 DashScope)
  api_key: "sk-a4eee1b50b9341c4a3f4f9abefe7460d"
  
  # 是否启用情绪分析
  enable_sentiment_filter: true
  
  # 情绪分数阈值（用于极端负面情况的安全过滤）
  sentiment_threshold: -0.5
  
  # ===== 缓存配置 =====
  cache_path: "data/processed/sentiment_cache.json"
  cache_ttl_days: 7
  
  # ===== API 配置 =====
  request_timeout: 30
  max_retries: 3
  max_concurrent: 5
  
  # ===== 提示词配置 =====
  detailed_prompts: true
  
  # ===== 熔断器与置信度配置 =====
  max_consecutive_failures: 5
  min_confidence: 0.7
  sentiment_buffer_multiplier: 5

# 交易配置
trading:
  # 交易费用（双边）- 标准A股费率
  commission_rate: 0.0003
  
  # 印花税（卖出时）
  stamp_duty: 0.001
  
  # 滑点比例
  slippage: 0.001
  
  # 最小交易单位（股）
  min_trade_unit: 100

# 报告配置
report:
  # 报告格式: markdown, html
  format: "html"
  
  # 报告输出目录
  output_dir: "reports"
  
  # 是否发送邮件通知
  send_email: false
  
  # 邮件配置
  email:
    smtp_server: ""
    smtp_port: 587
    sender: ""
    password: ""
    recipients: []

# 消息推送配置
notification:
  # PushPlus 微信推送 (http://www.pushplus.plus/)
  pushplus_token: "c71a6a03122e41e3b0b691693748c0ce"
  
  # 是否启用推送
  enabled: true

# 日志配置
logging:
  # 日志级别: DEBUG, INFO, WARNING, ERROR
  level: "INFO"
  
  # 日志文件目录
  log_dir: "logs"
  
  # 日志文件保留天数
  retention_days: 30

# 回测配置
backtest:
  # 回测开始日期
  start_date: "2024-01-01"
  
  # 回测结束日期
  end_date: "2025-01-01"
  
  # 初始资金
  initial_capital: 300000
  
  # 基准指数
  # [配合股票池] 沪深300基准
  benchmark: "000300"

  # 回测最大股票数量
  max_stocks: 300
