# A股量化交易系统 - 策略配置文件
# ===============================
# 中证1000 强动量 + 情绪进攻策略 (Aggressive Momentum & Sentiment Strategy)

# 数据配置
data:
  # 股票池: hs300(沪深300), zz500(中证500), zz1000(中证1000), all(全市场)
  # 中证1000提供更高弹性，适合动量+情绪策略
  stock_pool: "zz1000"
  
  # 历史数据开始日期
  start_date: "2020-01-01"
  
  # 每次增量更新的天数（建议至少30天，以支持ROC_20等因子计算）
  update_days: 30
  
  # 数据存储路径
  raw_data_path: "data/raw"
  processed_data_path: "data/processed"

# 策略配置 - 中证1000强动量+情绪进攻策略
strategy:
  # 策略名称
  name: "Aggressive Momentum & Sentiment"
  
  # 因子权重配置 (强动量 + 情绪进攻型)
  # Base_Score = value_weight * Value_Z + quality_weight * Turnover_Z 
  #            + momentum_weight * ROC20_Z + size_weight * SmallCap_Z
  # Final_Score = Base_Score + sentiment_weight * Sentiment_Score
  # 
  # 策略逻辑：
  # - 放弃估值因子（中盘股已无估值优势）
  # - 放弃小市值因子（已通过 zz1000 股池锁定）
  # - 核心依赖动量因子（ROC_20）捕捉趋势
  # - 换手率因子确保资金活跃度
  # - LLM 情绪因子作为 Alpha 加成
  value_weight: 0.0      # 放弃估值因子
  quality_weight: 0.2    # 换手率因子（资金活跃度，对应 turnover_5d_zscore）
  momentum_weight: 0.3   # 核心动量因子（对应 roc_20_zscore）
  size_weight: 0.3       # 小市值因子（明确小市值因子的主导地位）
  sentiment_weight: 0.2  # 新增：情绪因子权重（LLM 分析结果作为 Alpha 加成）
  
  # 选股参数（集中持仓，追求高弹性）
  top_n: 6              # 选取6只股票，降低单只股票风险
  min_listing_days: 126  # 最小上市天数（约6个月）
  
  # 因子列名配置（与 features.py 产出列名一致）
  # turnover_5d_zscore: 5日平均换手率的标准化
  # roc_20_zscore: 20日变动率(ROC)的标准化 - 使用新添加的 ROC_20 因子
  value_col: "value_zscore"           # 未使用（权重为0）
  quality_col: "turnover_5d_zscore"   # 换手率因子
  momentum_col: "roc_20_zscore"       # 核心动量因子：20日变动率
  size_col: "small_cap_zscore"        # 未使用（权重为0）
  
  # 调仓频率: monthly(月度), weekly(周度)
  # 周度调仓更适合动量策略，快速捕捉趋势变化
  rebalance_frequency: "weekly"
  
  # 再平衡缓冲区：权重变化小于此阈值时不调整
  # 动量策略降低缓冲区（2%），更敏感响应信号变化
  rebalance_buffer: 0.03

# 投资组合配置 - 激进型（集中持仓）
portfolio:
  # 总资金（元）
  total_capital: 300000
  
  # 单只股票最大权重
  # 对于3只股票的激进策略，允许更高集中度
  max_weight: 0.40
  
  # 单只股票最小权重
  min_weight: 0.0
  
  # 无风险利率
  risk_free_rate: 0.02
  
  # 优化目标: max_sharpe(最大夏普比率), min_volatility(最小波动率), equal_weight(等权重)
  # 激进策略使用等权重，避免优化器在高波动股票上的不稳定
  optimization_objective: "equal_weight"
  
  # 协方差压缩方法: ledoit_wolf, oracle_approximating, exponential
  shrinkage_type: "ledoit_wolf"
  
  # 预期收益率计算方法: mean_historical, ema_historical
  returns_method: "mean_historical"
  
  # 协方差计算回溯天数
  lookback_days: 252

# 风险控制配置 - 激进型参数
risk:
  # 止损比例（放宽：避免频繁被洗）
  stop_loss: 0.08
  
  # 止盈比例
  take_profit: 0.30
  
  # 单日最大亏损比例
  max_daily_loss: 0.05
  
  # 最大回撤限制（放宽：容忍更高波动以获取高收益）
  max_drawdown: 0.25
  
  # 大盘风控参数（激进型：使用 MA60 + 20日跌幅判断）
  # 仅当大盘跌破60日均线且20日跌幅超过5%时才触发熔断
  market_risk:
    enabled: true
    ma_period: 20           # 使用20日均线（反应更灵敏）
    drop_threshold: 0.05    # 20日跌幅阈值（5%）
    drop_lookback: 20       # 跌幅回溯天数

# LLM 情绪分析配置
# 情绪进攻型策略：情绪分数作为 Alpha 因子加成，而非仅用于过滤
# 采用两阶段选股模式：
#   1. 技术面初筛 → Top N * buffer 候选股
#   2. LLM 情绪分析 → 获取情绪分数
#   3. Final_Score = Base_Score + Sentiment_Weight * Sentiment_Score → 最终排名
llm:
  # 提供商: qwen (阿里云通义千问)
  provider: "qwen"
  
  # 模型名称 (qwen3-max 是通义千问3旗舰版)
  model: "qwen-max"
  
  # API 端点 (阿里云 DashScope OpenAI 兼容模式)
  base_url: "https://dashscope.aliyuncs.com/compatible-mode/v1"
  
  # API Key (阿里云 DashScope)
  api_key: "sk-a4eee1b50b9341c4a3f4f9abefe7460d"
  
  # 是否启用情绪分析
  # 启用后，情绪分数将作为 Alpha 因子加成到综合得分中
  # 注意：在新的情绪进攻型策略中，情绪分数是加分项而非仅过滤项
  enable_sentiment_filter: true
  
  # 情绪分数阈值（保留用于极端负面情况的安全过滤）
  # 分数范围: -1.0 (极度负面) 到 1.0 (极度正面)
  # 低于此阈值的股票仍会被禁止交易（黑天鹅风控）
  sentiment_threshold: -0.5
  
  # 情绪缓存文件路径
  # 用于避免回测时重复调用 API
  cache_path: "data/processed/sentiment_cache.json"
  
  # API 请求超时时间（秒）
  request_timeout: 30
  
  # API 最大重试次数
  max_retries: 3
  
  # ===== 熔断器与置信度配置 =====
  
  # 熔断器阈值：连续 API 调用失败次数
  # 超过此阈值时，系统将抛出 LLMCircuitBreakerError 异常停止交易
  # 这是一个安全机制，防止在 API 不可用时继续操作
  max_consecutive_failures: 5
  
  # 最低置信度阈值
  # LLM 返回的置信度低于此值的分析结果将被忽略
  # 置信度范围: 0.0 (完全不确定) 到 1.0 (非常确定)
  # 低置信度的股票会被跳过并记录警告日志
  min_confidence: 0.7
  
  # 情绪分析缓冲区乘数
  # 选取 top_n * buffer_multiplier 只股票进行情绪分析
  # 例如: top_n=3, buffer_multiplier=5 → 分析 15 只候选股票
  # 扩大初筛范围，确保从更多候选股中优中选优
  sentiment_buffer_multiplier: 5

# 交易配置
trading:
  # 交易费用（双边）- 标准A股费率
  commission_rate: 0.0003
  
  # 印花税（卖出时）
  stamp_duty: 0.001
  
  # 滑点比例
  slippage: 0.001
  
  # 最小交易单位（股）
  min_trade_unit: 100

# 报告配置
report:
  # 报告格式: markdown, html
  format: "html"
  
  # 报告输出目录
  output_dir: "reports"
  
  # 是否发送邮件通知
  send_email: false
  
  # 邮件配置
  email:
    smtp_server: ""
    smtp_port: 587
    sender: ""
    password: ""
    recipients: []

# 消息推送配置
notification:
  # PushPlus 微信推送 (http://www.pushplus.plus/)
  # Token 获取方式：注册 PushPlus 账号后，在个人中心获取
  # 也可通过环境变量 PUSHPLUS_TOKEN 配置（优先级更高）
  pushplus_token: "c71a6a03122e41e3b0b691693748c0ce"
  
  # 是否启用推送
  enabled: true

# 日志配置
logging:
  # 日志级别: DEBUG, INFO, WARNING, ERROR
  level: "INFO"
  
  # 日志文件目录
  log_dir: "logs"
  
  # 日志文件保留天数
  retention_days: 30

# 回测配置
backtest:
  # 回测开始日期
  start_date: "2024-01-01"
  
  # 回测结束日期
  end_date: "2025-01-01"
  
  # 初始资金
  initial_capital: 300000
  
  # 基准指数
  # ZZ1000 (000852) 与中证1000股池匹配，适合动量策略
  benchmark: "000852"  # 中证1000
